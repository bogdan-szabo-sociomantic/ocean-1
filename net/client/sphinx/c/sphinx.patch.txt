/**
 * File contains Sphinx patch to enable sphinx_build_keywords() to return more than 10 keywords.
 *
 * The sphinx_build_keywords() method returns the statistics about the number of occurences
 * of the words from a search query within the search index. By default this method just returns
 * 10 items.
 *
 * (c) thomas nicolai () sociomantic labs
 */ 

1. PATCH: api/libsphinxclient/sphinxclient.c

line 1829
[-] sphinx_keyword_info * sphinx_build_keywords ( sphinx_client * client, const char * query, const char * index, sphinx_bool hits, int * out_num_keywords )
[+] sphinx_keyword_info * sphinx_build_keywords ( sphinx_client * client, const char * query, const char * index, int max_query_words, sphinx_bool hits, int * out_num_keywords ) 


line 1835
[+] if ( !max_query_words ) max_query_words = 10;


line 1847
[-] req_len = (int)( safestrlen(query) + safestrlen(index) + 12);
[+] req_len = (int)( safestrlen(query) + safestrlen(index) + 12 + 32 );

line 1866
[+] send_int ( &req, max_query_words);


2. PATCH: api/libsphinxclient/sphinxclient.h

line 209
[-] sphinx_build_keywords ( sphinx_client * client, const char * query, const char * index, sphinx_bool hits, int * out_num_keywords );
[+] sphinx_build_keywords ( sphinx_client * client, const char * query, const char * index, int max_query_words, sphinx_bool hits, int * out_num_keywords );


3. PATCH: src/searchd.cpp 

line 4379
[+] int nWords = tReq.GetInt();

line 4390
[-] dKeywords.Reserve ( SPH_MAX_QUERY_WORDS );
[+] dKeywords.Reserve ( nWords );

line 4393
[-] if ( !pIndex->m_pIndex->GetKeywords ( dKeywords, sQuery.cstr (), bGetStats ) )
[+] if ( !pIndex->m_pIndex->GetKeywords ( dKeywords, sQuery.cstr (), bGetStats, nWords ) )


4. PATCH: src/sphinx.cpp 

line 14564
[-] bool CSphIndex_VLN::GetKeywords ( CSphVector <CSphKeywordInfo> & dKeywords, const char * szQuery, bool bGetStats )
[+] bool CSphIndex_VLN::GetKeywords ( CSphVector <CSphKeywordInfo> & dKeywords, const char * szQuery, bool bGetStats, int max_query_words )

line 14605

[-] while ( ( sWord = m_pTokenizer->GetToken() )!=NULL && nWords<SPH_MAX_QUERY_WORDS )
[+] while ( ( sWord = m_pTokenizer->GetToken() )!=NULL && nWords<max_query_words )


5. PATCH: src/sphinx.h

line 2005
[-] GetKeywords ( CSphVector <CSphKeywordInfo> & dKeywords, const char * szQuery, bool bGetStats ) = 0;
[+] GetKeywords ( CSphVector <CSphKeywordInfo> & dKeywords, const char * szQuery, bool bGetStats, int max_query_words ) = 0;